---
title: "Checks after review Cog and Emotion"
author: "Peris-Yague et al. 2023"
date: "12/5/2023"
output: 
  html_document:
    df_print: paged
  github_document:
    toc: true
  pdf_document: default
  word_document: default
---
  
```{r  echo=FALSE, results='hide', message=FALSE, warning=FALSE}
chooseCRANmirror(graphics=FALSE, ind=1)
knitr::opts_chunk$set(echo = TRUE)

#Install all libraries 

library(tidyverse)
library(ggpubr)
library(rstatix)
library(rsample)
library(dplyr)
library(ggplot2)
library(data.table)
library(effects)
library(lme4)
library(plyr)
library(emmeans)
library(reshape2)
```


# ***Plot E and E-1 mean recall***

The table and plot below show the mean recall for each word (E oddballs and E-1 items). 

```{r echo=FALSE, warning=FALSE, message=FALSE}
rm(list=(ls()))
setwd("/Users/albaperis/OneDrive - UAM/PhDUPM_/Von Restroff WP3/Paper_github/Odd_SOA_CRP_Code_Reviewed/PerisYague2023/Raw_Results")

data<-read.csv('single_item_emotion.csv')
data$subject <- as.factor(data$subject)
data$recall <- as.numeric(data$recall) # 1 = recalled, 0 = not recalled
data$item_who <- as.factor(data$item_who) #eo = emotional oddball, emo_minus_one (E-1), ce = emotional control, ctrl_minus_one CE-1
data$word_who <- as.factor(data$word_who)

#Group data by emotional words and E-1. 
emotional_words <- filter(data, item_who == 'eo' | item_who == 'emo_minus_one')
emotional_words<-droplevels(emotional_words)

emotional_words_summary <- emotional_words %>%
  group_by(word_who,item_who) %>%
  get_summary_stats(recall, type = 'mean_sd')

emotional_words_summary

plt <- ggplot(emotional_words_summary, aes(x=word_who, y=mean,fill=item_who)) +
  #facet_wrap(~word_who)+
  geom_bar(stat='identity', position='dodge')+
  ggtitle('Mean amount of recalled emotional and E-1 items')+
  theme(text = element_text(size = 6))

plt

```

# ***Median-split the data between high and low recall E oddballs***

We now have done a median-split of the data of the mean recall of each E oddball. 

The histogram shows the distribution of the mean recall of all 20 items. 

A median split of the data shows a median value of 0.628. 

We then plotted E and E-1 recall for high (>0.62) vs. low (<0.62) recall items showing no differences in E-1 recall in the two groups.


```{r echo=FALSE, warning=FALSE, message=FALSE}
emotional_words <- filter(data, item_who == 'eo')
emotional_words<-droplevels(emotional_words)

aov.data <- emotional_words %>%
  group_by(word_who) %>%
  get_summary_stats(recall, type = 'mean_sd')

hist(aov.data$mean)

#Calculate median value
MedianValue <- median(aov.data$mean)

cat("The median value of the E recalled words is: ", MedianValue)

LowMedian <- filter(aov.data, mean <= MedianValue)
HighMedian <- filter(aov.data, mean > MedianValue)

high_recall<- data[data$word_who %in% c('amputaci�n', 'c�ncer','morgue', 'nazi','sida','suicida','terrorista','traidor','tumor','violaci�n'), ]
high_recall['recall_type'] = 'high'

low_recall<- data[data$word_who %in% c('ahogado', 'asesino', 'asfixia', 'ceguera','crimen', 'hambruna','masacre', 'parapl�jico','plaga','sufrimiento'), ]

low_recall['recall_type'] = 'low'

# Directly compare the two 
combined <- rbind(high_recall,low_recall)
 
combine_plt <- combined %>%
   group_by(item_who,recall_type) %>%
   get_summary_stats(recall, type = 'mean_sd')

combine_plt <- droplevels(combine_plt)
 
plt <- ggplot(combine_plt, aes(x=recall_type, y=mean, fill=recall_type)) +
   facet_wrap(~item_who)+
   geom_bar(stat='identity', position='dodge')+
   ggtitle('Mean amount of recalled items grouped by median (High: >0.62, Low: <0.62)')
 
plt

# Run a t-test comparing the two
high.ttest.data <- high_recall %>%
  group_by(item_who,word_who) %>%
  get_summary_stats(recall, type='mean_ci')

high.ttest.data['recall_type'] = 'high'

low.ttest.data <- low_recall %>%
  group_by(item_who,word_who) %>%
  get_summary_stats(recall, type='mean_ci')

low.ttest.data['recall_type'] = 'low'


```

Now let's put the data in a two-way ANOVA with item (E oddball / E-1) x recall type (high / low ). Recall probability is the average recall values for that specific E word. 

The data going into the ANOVA is the following: 


```{r echo=FALSE, warning=FALSE, message=FALSE}

aov.data <- rbind(high.ttest.data, low.ttest.data)

aov.data # Just to have a look at the data that went into the ANOVA 

```

Results of the ANOVA and follow-up t-test:

```{r echo=FALSE, warning=FALSE, message=FALSE}
aov <- anova_test(data=aov.data, dv=mean, 
                  between=c(item_who,recall_type))

get_anova_table(aov)

# Follow-up t-test 
t.test.results <- aov.data %>%
  group_by(item_who) %>%
  pairwise_t_test(mean~recall_type, paired=FALSE, p.adjust.method='none')

t.test.results

# Add t-test results to plot 

t.test.results <- t.test.results %>% add_xy_position(x='recall_type')

plt + stat_pvalue_manual(t.test.results, label = '{p} {p.adj.signif}', inherit.aes = FALSE, 
                         hide.ns = FALSE, tip.length=0.05, 
                         step.increase=0.1, bracket.nudge.y=0)+
  scale_y_continuous(expand=expansion(mult=c(0,0.1)))

```

Control for memory for control items in the list 

```{r echo=FALSE, warning=FALSE, message=FALSE}
rm(list=(ls()))
setwd("/Users/albaperis/OneDrive - UAM/PhDUPM_/Von Restroff WP3/Paper_github/Odd_SOA_CRP_Code_Reviewed/PerisYague2023/Raw_Results")

data<-read.csv('single_item_emotion.csv')
data$subject <- as.factor(data$subject)
data$recall <- as.numeric(data$recall) # 1 = recalled, 0 = not recalled
data$item_who <- as.factor(data$item_who) #eo = emotional oddball, emo_minus_one (E-1), ce = emotional control, ctrl_minus_one CE-1
data$word_who <- as.factor(data$word_who)
data$list <- as.factor(data$list)

data_wide<-dcast(data=data, formula=subject+list ~ item_who, value.var="recall")
data_wide$EmC <- data_wide$eo - data_wide$ce
data_wide$Eminusone_mC <- data_wide$emo_minus_one - data_wide$ce # is this what we want to look at ??

# convert back to long 

data_long <- gather(data_wide, item_who, recall, EmC:Eminusone_mC, factor_key=TRUE)
data_long_grouped <- data_long %>%group_by(subject,list,item_who,recall)

# get emotional words
emotional_words <- filter(data, item_who == 'eo' | item_who == 'emo_minus_one')


data_long = select(data_long, 'subject','list','item_who','recall')

levels(data_long$item_who)[levels(data_long$item_who)=='EmC'] <- 'eo'
levels(data_long$item_who)[levels(data_long$item_who)=='Eminusone_mC'] <- 'emo_minus_one'

# Put the two dataframes in order 
emotional_words[order( emotional_words[,1], emotional_words[,5] ),]

data_long[order(data_long[,1], data_long[,2]),]

data_long$word_who <- emotional_words$word_who

# Now lets plot it 

emotional_words_summary <- data_long %>%
  group_by(word_who,item_who) %>%
  get_summary_stats(recall, type = 'mean_sd')

emotional_words_summary

emotional_words_summary$item_who <- factor(emotional_words_summary$item_who, 
                                           levels = c('emo_minus_one','eo'))

#positions <- c("emo_minus_one", "eo")

plt <- ggplot(emotional_words_summary, aes(x=word_who, y=mean,fill=item_who)) +
  #facet_wrap(~word_who)+
  geom_bar(stat='identity', position='dodge')+
  ggtitle('Mean amount of recalled emotional and E-1 items (-control)')+
  theme(text = element_text(size = 6))
 # scale_x_discrete(limits = positions)

plt


```




Now group by the words by the initial items /lists defined earlier that were better recalled than others: 

- high recall = amputación, cáncer, morgue, nazi, sida, suicida, terrorista, traidor, tumor, violación

- low recall = ahogado, asesino, asfixia, ceguera, crimen, hambruna, masacre, parapléjico, plaga, sufrimiento

```{r echo=FALSE, warning=FALSE, message=FALSE}

high_recall<- emotional_words_summary[emotional_words_summary$word_who %in% c('amputaci�n', 'c�ncer','morgue', 'nazi','sida','suicida','terrorista','traidor','tumor','violaci�n'), ]
high_recall['recall_type'] = 'high'

low_recall<- emotional_words_summary[emotional_words_summary$word_who %in% c('ahogado', 'asesino', 'asfixia', 'ceguera','crimen', 'hambruna','masacre', 'parapl�jico','plaga','sufrimiento'), ]

low_recall['recall_type'] = 'low'

# Directly compare the two 
combined <- rbind(high_recall,low_recall)
 
combine_plt <- combined %>%
   group_by(item_who,recall_type) %>%
   get_summary_stats(mean, type = 'mean_sd')

combine_plt <- droplevels(combine_plt)
 
plt <- ggplot(combine_plt, aes(x=recall_type, y=mean, fill=recall_type)) +
   facet_wrap(~item_who)+
   geom_bar(stat='identity', position='dodge')+
   ggtitle('Mean amount of rec. items (- ctrl) grouped by median (High: >0.62, Low: <0.62)')
 
plt

```

Grouping the items from those emotional lists that had high vs. low recall: in high recall lists, the E-1 nouns were recalled equally than control words (i.e. mean recall = 0), in low recall lists memory for E-1 words was lower than for C words (because probably overall worse recall in the list). 

But a t-test between E-1 recall in high vs. low lists is not significant

Therefore, even when splitting the lists by high / low emotional oddball recall does not show a retrograde amnesic effect. This is in line with our Bayesian stats results that provide strong support of no peri-oddball amnesic effects in this version of the task. 


```{r echo=FALSE, warning=FALSE, message=FALSE}
# Check for regrograde amnesic effects with t-test 

# t.test.results <- aov.data %>%
#   group_by(item_who) %>%
#   pairwise_t_test(mean~recall_type, paired=FALSE, p.adjust.method='none')
# 
# high_recall %>% pairwise_t_test(mean~item_who, paired=TRUE, p.adjust.method='none')
# 
# low_recall %>% pairwise_t_test(mean~item_who, paired=TRUE, p.adjust.method='none')
# 
# combined %>% pairwise_t_test(mean~item_who, paired=TRUE, p.adjust.method='none')
# 
# ggboxplot(data=high_recall, x='item_who', y='mean')

# aov <- anova_test(data=combined, dv=mean, 
#                   between=c(item_who,recall_type))
# 
# get_anova_table(aov)

# Follow-up on the interaction- no significant differences between E-1 items in high vs. low recall whereas for the E oddballs, there is a significant difference (obviously because the data was split between high and low recall)

t.test.results <- combined %>% 
  group_by(item_who) %>%
  pairwise_t_test(mean~recall_type, paired=TRUE, p.adjust.method='none')

t.test.results

t.test.results <- t.test.results %>% add_xy_position(x='recall_type')

plt + stat_pvalue_manual(t.test.results, label = '{p} {p.adj.signif}', inherit.aes = FALSE, 
                         hide.ns = FALSE, tip.length=0.05, 
                         step.increase=0.1, bracket.nudge.y=0)+
  scale_y_continuous(expand=expansion(mult=c(0,0.1)))

```


Looking at E-1 recall for the items that elicit 'amnesia': 'amputaci�n', 'asesino', 'morgue', 'parapl�jico', 'sufrimiento', 'terrorista'

vs. the ones that 'did not elicit amnesia': 'c�ncer', 'nazi', 'sida', 'suicida', 'traidor', 'tumor','violaci�n', 'ahogado', 'asfixia', 'ceguera', 'crimen', 'hambruna', 'masacre', 'plaga'

Even though it's 6 vs. 14 words, ran an unpaired t-test and there are no differences in E-1 recall within the two groups, so the 'amnesia' we see is not strong enough to be different from other items.

```{r echo=FALSE, warning=FALSE, message=FALSE}

# Anova of E-1 to test whether some words elicit amnesia 
emotional_words_aov <- filter(emotional_words_summary, item_who == 'emo_minus_one')

amnesia <- emotional_words_aov[emotional_words_aov$word_who %in% c('amputaci�n', 'asesino', 'morgue', 'parapl�jico', 'sufrimiento', 'terrorista'), ]

amnesia['amnesia_type'] = 'yes'

noamnesia <- emotional_words_aov[emotional_words_aov$word_who %in% c('c�ncer', 'nazi', 'sida', 'suicida', 'traidor', 'tumor','violaci�n', 'ahogado', 'asfixia', 'ceguera', 'crimen', 'hambruna', 'masacre', 'plaga' ), ]
  
noamnesia['amnesia_type'] = 'no'

combined <- rbind(amnesia,noamnesia)
combined <- droplevels(combined)

aov <- anova_test(data=combined, dv=mean, 
                   between=c(amnesia_type))
 
get_anova_table(aov)

```



# CRP curves divided by the 'amnesic' vs. 'non-amnesic' items above 

Now, look at CRP curves separating by items that caused 'amnesia' i.e. amputación, asesino, morgue, parapléjico, sufrimiento, terrorista vs. all other emotional lists.

Conclusion: No differences in CRPs.

```{r echo=FALSE, warning=FALSE, message=FALSE}

# Transitions from oddballs 
setwd("/Users/albaperis/OneDrive - UAM/PhDUPM_/Von Restroff WP3/Paper_github/Odd_SOA_CRP_Code_Reviewed/PerisYague2023/June23/Raw_data")
TFCRP<-read.csv('ToFrom_CRP_items_amnesia_R.csv')
TFCRP<-as.data.frame(TFCRP)
#head(TFCRP) #to show you what my raw data looks like 

TFplot<-TFCRP %>%
  group_by(oddballtype,wordposition, direction,transition) %>%
  get_summary_stats(CRP,type='mean_ci')

wpplot<-numeric(0)
for (rows in 1:nrow(TFplot)){
  if (TFplot$direction[rows] == "Backwards") {
    wpplot[rows]<-(TFplot$wordposition[rows])*-1
  }
  else {wpplot[rows]<-(TFplot$wordposition[rows])
  }
}
invisible(as.data.frame(wpplot))
TFplot$wpplot<-wpplot
TFplot$transition<-factor(TFplot$transition, levels=c('to','from'))

transition.labs<- c('Transition TO the oddball', 'Transition FROM the oddball')
names(transition.labs)<-c('to', 'from')

TFplot <- filter(TFplot, transition == 'from') 
TFplot <- droplevels(TFplot)


pltTF<-ggplot(TFplot,aes(x=wpplot,y=mean), group=oddballtype)+
  geom_line(aes(color=oddballtype), size=1) +
  geom_point(aes(color=oddballtype), size=2) +
  geom_ribbon(aes(ymin=mean-ci, ymax=mean+ci, fill=oddballtype), alpha=0.2, show.legend = FALSE, inherit.aes=TRUE)+
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se,color=oddballtype), alpha=0.5)+
   theme_classic()+
  facet_grid(transition~direction, scales='free_x', 
            labeller=labeller(transition = as_labeller(transition.labs)))+   
  theme(strip.background = element_blank())+
  theme(text=element_text(size=25))+
  xlab('Lag') +
  ylab('Conditional Response Probability')+
 # scale_color_manual(values=c('violetred2','turquoise2'), 
                   #  labels=c('Emotional','Perceptual'), name='Oddball List Type', aesthetics=c('colour','fill'))+
  scale_y_continuous(
  labels = scales::number_format(accuracy = 0.01))
 

pltTF

```

# CRP curves divided by 'amnesia' vs. 'no amnesia' when the E oddball was recalled > controls

CRP curves separating by items that have 'amnesia' vs. 'no amnesia' only for those lists when the Emo Odd were better recalled than control items.

Amnesia: amputación, asesino, morgue, parapléjico, sufrimiento, terrorista

No amnesia: cáncer, nazi, sida, suicida, traidor, tumor, violación, asifixia, masacre

Conclusion: No differences in CRPs. 

```{r echo=FALSE, warning=FALSE, message=FALSE}

# Transitions from oddballs 
setwd("/Users/albaperis/OneDrive - UAM/PhDUPM_/Von Restroff WP3/Paper_github/Odd_SOA_CRP_Code_Reviewed/PerisYague2023/June23/Raw_data")
TFCRP<-read.csv('ToFrom_CRP_items_amnesia_EOincreased_R.csv')
TFCRP<-as.data.frame(TFCRP)
#head(TFCRP) #to show you what my raw data looks like 

TFplot<-TFCRP %>%
  group_by(oddballtype,wordposition, direction,transition) %>%
  get_summary_stats(CRP,type='mean_ci')

wpplot<-numeric(0)
for (rows in 1:nrow(TFplot)){
  if (TFplot$direction[rows] == "Backwards") {
    wpplot[rows]<-(TFplot$wordposition[rows])*-1
  }
  else {wpplot[rows]<-(TFplot$wordposition[rows])
  }
}
invisible(as.data.frame(wpplot))
TFplot$wpplot<-wpplot
TFplot$transition<-factor(TFplot$transition, levels=c('to','from'))

transition.labs<- c('Transition TO the oddball', 'Transition FROM the oddball')
names(transition.labs)<-c('to', 'from')

TFplot <- filter(TFplot, transition == 'from') 
TFplot <- droplevels(TFplot)


pltTF<-ggplot(TFplot,aes(x=wpplot,y=mean), group=oddballtype)+
  geom_line(aes(color=oddballtype), size=1) +
  geom_point(aes(color=oddballtype), size=2) +
  geom_ribbon(aes(ymin=mean-ci, ymax=mean+ci, fill=oddballtype), alpha=0.2, show.legend = FALSE, inherit.aes=TRUE)+
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se,color=oddballtype), alpha=0.5)+
   theme_classic()+
  facet_grid(transition~direction, scales='free_x', 
            labeller=labeller(transition = as_labeller(transition.labs)))+   
  theme(strip.background = element_blank())+
  theme(text=element_text(size=25))+
  xlab('Lag') +
  ylab('Conditional Response Probability')+
 # scale_color_manual(values=c('violetred2','turquoise2'), 
                   #  labels=c('Emotional','Perceptual'), name='Oddball List Type', aesthetics=c('colour','fill'))+
  scale_y_continuous(
  labels = scales::number_format(accuracy = 0.01))
 

pltTF

```


# CRP curves divided high vs. low E recall

Now, look at CRP curves separating by items that have high vs. low recall (by median split). 

High recall: amputación, cáncer, morgue, nazi, sida, suicida, terrorista, traidor, tumor, violación

Low recall: ahogado, asesino, asfixia, ceguera, crimen, hambruna, masacre, parapléjico, plaga, sufrimiento

Conclusion: No differences in CRPs. 

```{r echo=FALSE, warning=FALSE, message=FALSE}

# Transitions from oddballs 
setwd("/Users/albaperis/OneDrive - UAM/PhDUPM_/Von Restroff WP3/Paper_github/Odd_SOA_CRP_Code_Reviewed/PerisYague2023/June23/Raw_data")
TFCRP<-read.csv('ToFrom_CRP_items_rectype_R.csv')
TFCRP<-as.data.frame(TFCRP)
#head(TFCRP) #to show you what my raw data looks like 

TFplot<-TFCRP %>%
  group_by(oddballtype,wordposition, direction,transition) %>%
  get_summary_stats(CRP,type='mean_ci')

wpplot<-numeric(0)
for (rows in 1:nrow(TFplot)){
  if (TFplot$direction[rows] == "Backwards") {
    wpplot[rows]<-(TFplot$wordposition[rows])*-1
  }
  else {wpplot[rows]<-(TFplot$wordposition[rows])
  }
}
invisible(as.data.frame(wpplot))
TFplot$wpplot<-wpplot
TFplot$transition<-factor(TFplot$transition, levels=c('to','from'))

transition.labs<- c('Transition TO the oddball', 'Transition FROM the oddball')
names(transition.labs)<-c('to', 'from')

TFplot <- filter(TFplot, transition == 'from') 
TFplot <- droplevels(TFplot)


pltTF<-ggplot(TFplot,aes(x=wpplot,y=mean), group=oddballtype)+
  geom_line(aes(color=oddballtype), size=1) +
  geom_point(aes(color=oddballtype), size=2) +
  geom_ribbon(aes(ymin=mean-ci, ymax=mean+ci, fill=oddballtype), alpha=0.2, show.legend = FALSE, inherit.aes=TRUE)+
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se,color=oddballtype), alpha=0.5)+
   theme_classic()+
  facet_grid(transition~direction, scales='free_x', 
            labeller=labeller(transition = as_labeller(transition.labs)))+   
  theme(strip.background = element_blank())+
  theme(text=element_text(size=25))+
  xlab('Lag') +
  ylab('Conditional Response Probability')+
 # scale_color_manual(values=c('violetred2','turquoise2'), 
                   #  labels=c('Emotional','Perceptual'), name='Oddball List Type', aesthetics=c('colour','fill'))+
  scale_y_continuous(
  labels = scales::number_format(accuracy = 0.01))
 

pltTF

```


